# 视频检测追踪打码工具

## 简介

这是一个基于YOLO目标检测和OpenCV图像处理的GUI应用程序，用于对视频中的特定对象进行检测和模糊处理（打码）。该工具可以帮助用户快速地对视频中敏感或隐私内容进行模糊处理，同时保留原始视频的音频。
示例视频:[https://www.bilibili.com/video/BV1DZm4BLEum/](https://www.bilibili.com/video/BV1DZm4BLEum/)

## 功能特点

- **YOLO模型支持**：支持加载自定义的YOLO模型文件(.pt)
- **多种视频格式**：支持MP4、AVI、MKV等常见视频格式
- **智能类别检测**：通过随机抽帧检测视频中出现的目标类别
- **选择性处理**：可以选择特定类别进行模糊处理
- **可调模糊强度**：提供滑块调节模糊强度，范围1-20级
- **多线程处理**：采用多线程技术避免界面卡顿
- **音频保留**：处理后的视频会保留原始音频
- **实时状态显示**：在处理过程中显示详细的状态信息

## 技术栈

- Python 3.x
- OpenCV (cv2)
- NumPy
- Ultralytics YOLO
- PyQt5
- FFmpeg

## 安装依赖

```bash
pip install opencv-python
pip install numpy
pip install ultralytics
pip install pyqt5
```

注意：需要系统中已安装FFmpeg并配置到环境变量中。

## 使用方法

1. 运行程序：
   ```
   python 视频检测追踪打码.py
   ```

2. 点击"选择模型文件"按钮，选择YOLO模型文件(.pt)
   - 如果不选择模型，程序会自动加载yolov8n.pt

3. 点击"选择视频文件"按钮，选择要处理的视频文件

4. 设置"随机抽帧数量"，用于类别检测（建议设置为100-500帧）

5. 点击"开始检测类别"按钮，程序会随机抽取指定帧数进行目标检测

6. 在下拉框中选择需要打码的目标类别

7. 调整"模糊强度"滑块设置模糊程度（数值越大越模糊）

8. 点击"开始处理"按钮开始视频处理

9. 处理完成后会在原视频目录生成带_final标记的输出文件

## 工作原理

1. **类别检测阶段**：
   - 随机抽取用户指定数量的视频帧
   - 使用YOLO模型对每一帧进行目标检测
   - 收集所有检测到的目标类别

2. **视频处理阶段**：
   - 逐帧读取视频
   - 每3帧进行一次目标检测以提高处理速度
   - 对检测到的指定类别目标区域进行高斯模糊处理
   - 将处理后的帧写入临时视频文件

3. **音频合并阶段**：
   - 使用FFmpeg将处理后的无声视频与原始视频的音频轨道合并
   - 生成最终的输出视频文件

## 注意事项

- 处理大尺寸视频时可能需要较长时间，请耐心等待
- 模糊强度设置过高可能会影响视频观看体验
- 程序会自动删除处理过程中的临时文件
- 输出文件会保存在与源视频相同的目录下

## 常见问题

**Q: 程序提示找不到FFmpeg？**
A: 请确保系统中已安装FFmpeg并将其路径添加到环境变量中。

**Q: 检测不到目标类别？**
A: 可以尝试增加随机抽帧数量，或者更换更适合的YOLO模型。

**Q: 处理速度很慢怎么办？**
A: 可以降低视频分辨率后再进行处理，或者使用性能更强的YOLO模型。

## 版本信息

- 版本号：1.0
- 发布日期：2025年
- 开发者：lele1894

## 许可证

本项目仅供学习交流使用，请勿用于商业用途。
